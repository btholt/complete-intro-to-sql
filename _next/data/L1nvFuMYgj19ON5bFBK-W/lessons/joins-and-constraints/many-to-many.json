{"pageProps":{"post":{"attributes":{"description":"","title":"Many-to-Many Relationships"},"html":"<p>So let&#39;s now make our recipes connect to our ingredients!</p>\n<p>This is a bit different because it&#39;s a many-to-many relationship. A recipe has many ingredients, and an ingredient can belong to many recipes (eggs are in both khachapuri and cookies.)</p>\n<pre><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> recipe_ingredients (\n  recipe_id <span class=\"hljs-type\">INTEGER</span> <span class=\"hljs-keyword\">REFERENCES</span> recipes(recipe_id) <span class=\"hljs-keyword\">ON</span> <span class=\"hljs-keyword\">DELETE</span> <span class=\"hljs-keyword\">NO</span> ACTION,\n  ingredient_id <span class=\"hljs-type\">INTEGER</span> <span class=\"hljs-keyword\">REFERENCES</span> ingredients(id) <span class=\"hljs-keyword\">ON</span> <span class=\"hljs-keyword\">DELETE</span> <span class=\"hljs-keyword\">NO</span> ACTION,\n  <span class=\"hljs-keyword\">CONSTRAINT</span> recipe_ingredients_pk <span class=\"hljs-keyword\">PRIMARY</span> KEY (recipe_id, ingredient_id)\n);\n</code></pre>\n<p>We set this to error because we should clear out connections before we let developers delete recipes or ingredients. We don&#39;t want to cascade deletes because that could delete recipes and ingredients unintentionally and we don&#39;t want to set to null because then we&#39;d have a bunch of half-null connections left over.</p>\n<p>We&#39;re going over constraints in the next chapter but we&#39;re basically saying &quot;the combination of recipe_id and ingredient_id must be unique&quot; and we&#39;re setting that as the primary key instead of an incrementing ID.</p>\n<p>This table will describe the many-to-many relationship with two foreign keys between ingredients and recipes. Now we can insert records into here that describe how an ingredient belongs to a recipe.</p>\n<pre><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> recipe_ingredients\n  (recipe_id, ingredient_id)\n<span class=\"hljs-keyword\">VALUES</span>\n  (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">10</span>),\n  (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">11</span>),\n  (<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">13</span>),\n  (<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">5</span>),\n  (<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">13</span>);\n</code></pre>\n<blockquote>\n<p>These recipes are nonsensical, don&#39;t expect them to be correct recipes.</p>\n</blockquote>\n<p>This is the way to connect multiple columns together. You have two tables that represent the two distinct concepts (ingredients and recipes) and then you use another table to describe the relationships between them.</p>\n<p>So now we have two recipes that have ingredients, cookies and empanadas. Since we inserted the cookies first, it will very likely have the id of 1 (unless you have inserted some other things.) Let&#39;s select those records.</p>\n<pre><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">SELECT</span>\n  i.title <span class=\"hljs-keyword\">AS</span> ingredient_title,\n  i.image <span class=\"hljs-keyword\">AS</span> ingredient_image,\n  i.type <span class=\"hljs-keyword\">AS</span> ingredient_type\n<span class=\"hljs-keyword\">FROM</span>\n  recipe_ingredients ri\n<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span>\n  ingredients i\n<span class=\"hljs-keyword\">ON</span>\n  i.id <span class=\"hljs-operator\">=</span> ri.ingredient_id\n<span class=\"hljs-keyword\">WHERE</span>\n  ri.recipe_id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;\n</code></pre>\n<p>Inner join is what we&#39;re looking for because we are only looking for rows that have connections on both sides.</p>\n<p>Now let&#39;s use another INNER JOIN to add in the recipes.</p>\n<pre><code class=\"hljs language-sql\"><span class=\"hljs-keyword\">SELECT</span>\n  i.title <span class=\"hljs-keyword\">AS</span> ingredient_title,\n  i.image <span class=\"hljs-keyword\">AS</span> ingredient_image,\n  i.type <span class=\"hljs-keyword\">AS</span> ingredient_type,\n  r.title <span class=\"hljs-keyword\">AS</span> recipe_title,\n  r.body <span class=\"hljs-keyword\">AS</span> recipe_body,\n  r.recipe_id <span class=\"hljs-keyword\">AS</span> rid,\n  i.id <span class=\"hljs-keyword\">AS</span> iid\n<span class=\"hljs-keyword\">FROM</span>\n  recipe_ingredients ri\n<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span>\n  ingredients i\n<span class=\"hljs-keyword\">ON</span>\n  i.id <span class=\"hljs-operator\">=</span> ri.ingredient_id\n<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span>\n  recipes r\n<span class=\"hljs-keyword\">ON</span>\n  r.recipe_id <span class=\"hljs-operator\">=</span> ri.recipe_id;\n</code></pre>\n","slug":"many-to-many","title":"Many-to-Many Relationships","section":"Joins and Constraints","icon":"code-merge","filePath":"/home/runner/work/complete-intro-to-sql/complete-intro-to-sql/lessons/04-joins-and-constraints/D-many-to-many.md","nextSlug":"/lessons/joins-and-constraints/constraints","prevSlug":"/lessons/joins-and-constraints/foreign-keys"}},"__N_SSG":true}